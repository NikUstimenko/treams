
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>Examples &#8212; treams 0.2.2.dev94+gf11285d documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/pyramid.css" />
    <link rel="stylesheet" type="text/css" href="_static/plot_directive.css" />
    <link rel="stylesheet" type="text/css" href="_static/no-nobiles.css" />
    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/sphinx_highlight.js"></script>
    <link rel="author" title="About these documents" href="about.html" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Theory" href="theory.html" />
    <link rel="prev" title="Getting started" href="gettingstarted.html" />
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Neuton&amp;subset=latin" type="text/css" media="screen" charset="utf-8" />
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Nobile:regular,italic,bold,bolditalic&amp;subset=latin" type="text/css" media="screen" charset="utf-8" />
<!--[if lte IE 6]>
<link rel="stylesheet" href="_static/ie6.css" type="text/css" media="screen" charset="utf-8" />
<![endif]-->

  </head><body>

    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="theory.html" title="Theory"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="gettingstarted.html" title="Getting started"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">treams 0.2.2.dev94+gf11285d documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Examples</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="examples">
<h1>Examples<a class="headerlink" href="#examples" title="Permalink to this heading">¶</a></h1>
<nav class="contents local" id="table-of-contents">
<p class="topic-title">Table of contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#t-matrix-examples" id="id2">T-matrix examples</a></p>
<ul>
<li><p><a class="reference internal" href="#particle-cluster" id="id3">Particle cluster</a></p></li>
<li><p><a class="reference internal" href="#d-arrays-of-particles" id="id4">3D-arrays of particles</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#cylindrical-t-matrix-examples" id="id5">Cylindrical T-matrix examples</a></p>
<ul>
<li><p><a class="reference internal" href="#clusters-of-cylindrical-rods" id="id6">Clusters of cylindrical rods</a></p></li>
<li><p><a class="reference internal" href="#id1" id="id7">1D-arrays of particles</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#q-matrix-examples" id="id8">Q-matrix examples</a></p>
<ul>
<li><p><a class="reference internal" href="#interfaces-and-homogeneous-media" id="id9">Interfaces and homogeneous media</a></p></li>
<li><p><a class="reference internal" href="#metasurfaces" id="id10">Metasurfaces</a></p></li>
<li><p><a class="reference internal" href="#gratings" id="id11">Gratings</a></p></li>
<li><p><a class="reference internal" href="#band-structure" id="id12">Band structure</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#loading-and-storing" id="id13">Loading and storing</a></p></li>
</ul>
</nav>
<p>The computations implemented in treams mainly revolve around three different types of
matrices: the (spherical) T-matrix, the cylindrical T-matrix and the S-matrices. These
three types of matrices emerge from using either spherical, cylindrical, or plane waves
as solutions to Maxwell’s equations. The examples are sorted into these three topics.
Each of these topics start with a short introduction on the particular type of matrix
before using it.</p>
<p>In all examples we assume that <code class="docutils literal notranslate"><span class="pre">import</span> <span class="pre">numpy</span> <span class="pre">as</span> <span class="pre">np</span></code> and <code class="docutils literal notranslate"><span class="pre">import</span> <span class="pre">treams</span></code> is used.</p>
<section id="t-matrix-examples">
<h2><a class="toc-backref" href="#id2" role="doc-backlink">T-matrix examples</a><a class="headerlink" href="#t-matrix-examples" title="Permalink to this heading">¶</a></h2>
<section id="particle-cluster">
<h3><a class="toc-backref" href="#id3" role="doc-backlink">Particle cluster</a><a class="headerlink" href="#particle-cluster" title="Permalink to this heading">¶</a></h3>
<p>We want to build a small snowman made of four spheres. Two for the body and head and two
smaller ones for each hand:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">k0</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">1000</span>
<span class="n">air</span> <span class="o">=</span> <span class="n">treams</span><span class="o">.</span><span class="n">Material</span><span class="p">()</span>
<span class="n">snow</span> <span class="o">=</span> <span class="n">treams</span><span class="o">.</span><span class="n">Material</span><span class="p">(</span><span class="mi">16</span> <span class="o">+</span> <span class="mf">0.1</span><span class="n">j</span><span class="p">)</span>
<span class="n">lmax</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">radii</span> <span class="o">=</span> <span class="p">[</span><span class="mi">150</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">30</span><span class="p">]</span>  <span class="c1"># head, body, right and left hand</span>
</pre></div>
</div>
<p>Here, we simply set the wavelength to <cite>1000</cite>. For our constant material parameters we
can choose the scale of wavelength and sphere radii arbitrarily, but for our example we
could simply assume e.g. the unit of the wavelength and the radii to be nanometers.
Up to now we only defined parameters, now we want to create the T-matrices. For
convenience we store the T-matrices in a simple list:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">snowballs</span> <span class="o">=</span> <span class="p">[</span><span class="n">treams</span><span class="o">.</span><span class="n">TMatrix</span><span class="o">.</span><span class="n">sphere</span><span class="p">(</span><span class="n">lmax</span><span class="p">,</span> <span class="n">k0</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="p">[</span><span class="n">snow</span><span class="p">,</span> <span class="n">air</span><span class="p">])</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">radii</span><span class="p">]</span>
</pre></div>
</div>
<p>Examining the call of <cite>treams</cite> in this example shows a simple structure. We use the
<a class="reference internal" href="generated/treams.TMatrix.html#treams.TMatrix" title="treams.TMatrix"><code class="xref py py-class docutils literal notranslate"><span class="pre">treams.TMatrix</span></code></a> for our object and then define the sphere. As a minimum the
maximal multipole order has to be given, then the vacuum wave number. Then, we define
the radius and finally the relative permittivities. The materials are given from the
inside to the outside.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The method <a class="reference internal" href="generated/treams.TMatrix.sphere.html#treams.TMatrix.sphere" title="treams.TMatrix.sphere"><code class="xref py py-func docutils literal notranslate"><span class="pre">treams.TMatrix.sphere()</span></code></a> is actually more general. It can calculate
the T-matrix of spherical core-shell particles with an arbitrary number of shells.
Also, each material can be chiral.</p>
</div>
<p>Now, we want to create a cluster of these T-matrices:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">positions</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">100</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">150</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="mi">85</span><span class="p">,</span> <span class="mi">145</span><span class="p">,</span> <span class="o">-</span><span class="mi">5</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="mi">80</span><span class="p">,</span> <span class="o">-</span><span class="mi">135</span><span class="p">,</span> <span class="o">-</span><span class="mf">7.5</span><span class="p">]]</span>
<span class="n">snowman</span> <span class="o">=</span> <span class="n">treams</span><span class="o">.</span><span class="n">TMatrix</span><span class="o">.</span><span class="n">cluster</span><span class="p">(</span><span class="n">snowballs</span><span class="p">,</span> <span class="n">positions</span><span class="p">)</span><span class="o">.</span><span class="n">interacted</span><span class="p">()</span>
</pre></div>
</div>
<p>We first create the cluster by giving the T-matrices of all its constituent particles
and specifying their positions. It is advised to always put the origin in a symmetry
point if possible. The invocation of <a class="reference internal" href="generated/treams.TMatrix.cluster.html#treams.TMatrix.cluster" title="treams.TMatrix.cluster"><code class="xref py py-func docutils literal notranslate"><span class="pre">treams.TMatrix.cluster()</span></code></a> does create a
block-diagonal T-matrix from all its constituents. However, the interaction between all
these particles has to computed in a separate step by using the method
<a class="reference internal" href="generated/treams.TMatrix.interacted.html#treams.TMatrix.interacted" title="treams.TMatrix.interacted"><code class="xref py py-func docutils literal notranslate"><span class="pre">treams.TMatrix.interacted()</span></code></a>. Now, <code class="docutils literal notranslate"><span class="pre">snowman</span></code> contains the <em>local</em> T-matrix. This
means that the full scattered field is described by spherical waves at multiple origins.
This has the benefit, that one can usually obtain correct fields closer to the geometric
object.</p>
<p>Now, we can calculate the scattering and extinction cross section of our little snowman
under a plane wave illumination along the x-axis:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">pw</span> <span class="o">=</span> <span class="n">treams</span><span class="o">.</span><span class="n">plane_wave</span><span class="p">(</span><span class="n">k0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">xs</span> <span class="o">=</span> <span class="n">snowman</span><span class="o">.</span><span class="n">xs</span><span class="p">(</span><span class="n">pw</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;scattering cross section: </span><span class="si">{</span><span class="n">xs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">, extinction cross section: </span><span class="si">{</span><span class="n">xs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Next, we can look at the field distribution. For this we first create a grid, that is
separated into three parts. First, the space occupied by the spheres, here, we cannot
easily calculate the fields. Second, the part that is outside the individual spheres but
inside of the circumscribing spheres. Here, we can calculate the fields using the local
T-matrix. Third, the part outside of the circumscribing sphere, where we can calculate
the fields using the local or the global T-matrix. Which calculation is more beneficial
and faster is determined by mainly by how many orders need to be included in both cases.
For the sake of a more diverse example we will do the latter:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">grid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mgrid</span><span class="p">[</span><span class="o">-</span><span class="mi">300</span><span class="p">:</span><span class="mi">300</span><span class="p">:</span><span class="mi">101</span><span class="n">j</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">300</span><span class="p">:</span><span class="mi">300</span><span class="p">:</span><span class="mi">101</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span><span class="o">.</span><span class="n">transpose</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
<span class="n">field</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">grid</span><span class="p">,</span> <span class="nb">complex</span><span class="p">)</span>

<span class="n">snowman_global</span> <span class="o">=</span> <span class="n">snowman</span><span class="o">.</span><span class="n">globalmat</span><span class="p">(</span><span class="n">treams</span><span class="o">.</span><span class="n">SphericalWaveBasis</span><span class="o">.</span><span class="n">default</span><span class="p">(</span><span class="mi">6</span><span class="p">))</span>
<span class="n">valid</span> <span class="o">=</span> <span class="n">snowman_global</span><span class="o">.</span><span class="n">valid_points</span><span class="p">(</span><span class="n">grid</span><span class="p">,</span> <span class="p">[</span><span class="mi">250</span><span class="p">])</span>
<span class="n">sca</span> <span class="o">=</span> <span class="n">snowman_global</span> <span class="o">@</span> <span class="n">pw</span><span class="o">.</span><span class="n">expand</span><span class="p">(</span><span class="n">snowman_global</span><span class="o">.</span><span class="n">basis</span><span class="p">)</span> <span class="o">@</span> <span class="n">pw</span>
<span class="n">field</span><span class="p">[</span><span class="n">valid</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="p">(</span><span class="n">sca</span><span class="o">.</span><span class="n">efield</span><span class="p">(</span><span class="n">grid</span><span class="p">[</span><span class="n">valid</span><span class="p">,</span> <span class="p">:])</span> <span class="o">*</span> <span class="n">sca</span><span class="p">[:,</span> <span class="kc">None</span><span class="p">])</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=-</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
<p>Mostly, we set up here a grid of points and separate the different regions. Finally, we
take the region outside of the circumscribing sphere of the snowman. Using the global
T-Matrix we calculate the scattererd field coefficients. In the last line, we multiply
those coefficients with the corresponding values of the efield of those modes.</p>
<p>Now we want to calculate the field between the spheres for which we work with the local
T-matrix and mostly repeat the previous steps.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">sca</span> <span class="o">=</span> <span class="n">snowman</span> <span class="o">@</span> <span class="n">pw</span><span class="o">.</span><span class="n">expand</span><span class="p">(</span><span class="n">snowman</span><span class="o">.</span><span class="n">basis</span><span class="p">)</span> <span class="o">@</span> <span class="n">pw</span>
<span class="n">valid</span> <span class="o">=</span> <span class="n">valid</span> <span class="o">^</span> <span class="n">snowman</span><span class="o">.</span><span class="n">valid_points</span><span class="p">(</span><span class="n">grid</span><span class="p">,</span> <span class="n">radii</span><span class="p">)</span>
<span class="n">field</span><span class="p">[</span><span class="n">valid</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="p">(</span><span class="n">sca</span><span class="o">.</span><span class="n">efield</span><span class="p">(</span><span class="n">grid</span><span class="p">[</span><span class="n">valid</span><span class="p">,</span> <span class="p">:])</span> <span class="o">*</span> <span class="n">sca</span><span class="p">[:,</span> <span class="kc">None</span><span class="p">])</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=-</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
<p>Now we can plot the full field around our snowman. We only add the illuminating plane
wave and arrive at:</p>
<p>We remark, that the field outside the circumscribing sphere (red dashed line) does
nicely fit with the field inside, indicating that the chosen expansion order for the
global T-matrix was sufficient.</p>
</section>
<section id="d-arrays-of-particles">
<h3><a class="toc-backref" href="#id4" role="doc-backlink">3D-arrays of particles</a><a class="headerlink" href="#d-arrays-of-particles" title="Permalink to this heading">¶</a></h3>
</section>
</section>
<section id="cylindrical-t-matrix-examples">
<h2><a class="toc-backref" href="#id5" role="doc-backlink">Cylindrical T-matrix examples</a><a class="headerlink" href="#cylindrical-t-matrix-examples" title="Permalink to this heading">¶</a></h2>
<section id="clusters-of-cylindrical-rods">
<h3><a class="toc-backref" href="#id6" role="doc-backlink">Clusters of cylindrical rods</a><a class="headerlink" href="#clusters-of-cylindrical-rods" title="Permalink to this heading">¶</a></h3>
<p>Due to the similarity of T-matrices and cylindrical T-matrices, we can build clusters
analogously. For this example we take infinitely extended cylinders, for which the
T-matrix entries can be computed analytically.</p>
<p>We begin with defining the cylinder parameters. For the embedding medium we choose a
non-zero value of the chirality parameter.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">kz</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">mmax</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">radii</span> <span class="o">=</span> <span class="p">[</span><span class="mi">150</span><span class="p">,</span> <span class="mi">100</span><span class="p">]</span>
<span class="n">cylinders</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">treams</span><span class="o">.</span><span class="n">TMatrixC</span><span class="o">.</span><span class="n">cylinder</span><span class="p">(</span><span class="n">kz</span><span class="p">,</span> <span class="n">mmax</span><span class="p">,</span> <span class="n">k0</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">16</span> <span class="o">+</span> <span class="mi">1</span><span class="n">j</span><span class="p">],</span> <span class="n">kappa</span><span class="o">=</span><span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">radii</span>
<span class="p">]</span>
<span class="n">positions</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">75</span><span class="p">,</span> <span class="mi">75</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="mi">110</span><span class="p">,</span> <span class="o">-</span><span class="mi">110</span><span class="p">,</span> <span class="mi">0</span><span class="p">]]</span>
<span class="n">cluster</span> <span class="o">=</span> <span class="n">treams</span><span class="o">.</span><span class="n">TMatrixC</span><span class="o">.</span><span class="n">cluster</span><span class="p">(</span><span class="n">cylinders</span><span class="p">,</span> <span class="n">positions</span><span class="p">)</span>
<span class="n">cluster</span><span class="o">.</span><span class="n">interact</span><span class="p">()</span>

</pre></div>
</div>
<p>In contrast to the case of spheres and spherical T-matrices, we now need to define the
value of the z-component of the wave vector. Multiple values have to be given. Later, we
will use one-dimensional periodic arrays (chains). Then, it’s necessary that the
different values correspond to a set of diffraction orders. Here, however, we only take
a single value for our example. Additionally to the wave vector component the maximal
azimuthal order is chosen to be 4. So, <cite>m</cite> runs from -4 to +4 in the T-matrix modes.</p>
<p>The next step is similar to the cluster example. The most important difference is, that
we use for the illumination a property of the cluster <cite>ks</cite> which holds the wave numbers
in the chiral medium. This is done just out of convenience.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<p>Finally, we just set up a suitable grid and plot the results. This time we calculate
the whole field in the local system, but we could have also chosen to change to the
global T-matrix for the computation of the field outside of the T-matrix.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">field</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">grid</span><span class="p">,</span> <span class="nb">complex</span><span class="p">)</span>
<span class="n">valid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span>
    <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">grid</span> <span class="o">-</span> <span class="n">positions</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">2</span><span class="p">),</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">radii</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">radii</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
    <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">grid</span> <span class="o">-</span> <span class="n">positions</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">2</span><span class="p">),</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">radii</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">radii</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
<span class="p">)</span>
<span class="n">scattered_field_coeff</span> <span class="o">=</span> <span class="n">cluster</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">grid</span><span class="p">[</span><span class="n">valid</span><span class="p">,</span> <span class="p">:])</span>
<span class="n">field</span><span class="p">[</span><span class="n">valid</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">scattered_field_coeff</span> <span class="o">*</span> <span class="p">(</span><span class="n">cluster</span><span class="o">.</span><span class="n">t</span> <span class="o">@</span> <span class="n">illu</span><span class="p">),</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">2</span><span class="p">)</span>
<span class="n">field</span><span class="p">[</span><span class="n">valid</span><span class="p">,</span> <span class="p">:]</span> <span class="o">+=</span> <span class="n">treams</span><span class="o">.</span><span class="n">special</span><span class="o">.</span><span class="n">vpw_A</span><span class="p">(</span>
</pre></div>
</div>
</section>
<section id="id1">
<h3><a class="toc-backref" href="#id7" role="doc-backlink">1D-arrays of particles</a><a class="headerlink" href="#id1" title="Permalink to this heading">¶</a></h3>
<p>This, example now turns to an one-dimensional array of spheres (chain). The coupling
between the spheres will be calculated with the Ewald method. Then, one can transition
from a description of coupled spheres, described by T-matrices to a description using
the cylindrical T-matrix.</p>
<p>We start by defining two spheres, that are within one unit cell. This means we have a
nontrivial unit cell for our system, resulting finally in a local cylindrical T-matrix.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">k0</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">700</span>  <span class="c1"># Wave number in vacuum</span>
<span class="n">materials</span> <span class="o">=</span> <span class="p">[</span><span class="n">treams</span><span class="o">.</span><span class="n">Material</span><span class="p">(</span><span class="o">-</span><span class="mf">16.5</span> <span class="o">+</span> <span class="mi">1</span><span class="n">j</span><span class="p">),</span> <span class="n">treams</span><span class="o">.</span><span class="n">Material</span><span class="p">()]</span>
<span class="n">lmax</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">radii</span> <span class="o">=</span> <span class="p">[</span><span class="mi">75</span><span class="p">,</span> <span class="mi">75</span><span class="p">]</span>
<span class="n">spheres</span> <span class="o">=</span> <span class="p">[</span><span class="n">treams</span><span class="o">.</span><span class="n">TMatrix</span><span class="o">.</span><span class="n">sphere</span><span class="p">(</span><span class="n">lmax</span><span class="p">,</span> <span class="n">k0</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">materials</span><span class="p">)</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">radii</span><span class="p">]</span>
<span class="n">positions</span> <span class="o">=</span> <span class="p">[[</span><span class="o">-</span><span class="mi">25</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">73</span><span class="p">],</span> <span class="p">[</span><span class="mi">25</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">73</span><span class="p">]]</span>
<span class="n">chain_sph</span> <span class="o">=</span> <span class="n">treams</span><span class="o">.</span><span class="n">TMatrix</span><span class="o">.</span><span class="n">cluster</span><span class="p">(</span><span class="n">spheres</span><span class="p">,</span> <span class="n">positions</span><span class="p">)</span>
<span class="n">pitch</span> <span class="o">=</span> <span class="mi">300</span>
<span class="n">kz</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">chain_sph</span> <span class="o">=</span> <span class="n">chain_sph</span><span class="o">.</span><span class="n">interacted_lattice</span><span class="p">(</span><span class="n">pitch</span><span class="p">,</span> <span class="n">kz</span><span class="p">)</span>
</pre></div>
</div>
<p>The definition of the unit cell is exactly the same to the definition of a regular
cluster. Now, one only needs to call the interaction calculation within the lattice,
which for a chain is simply defined by its pitch. Also, one needs to specify the
z-component of the wave vector (up to a reciprocal lattice vector).</p>
<p>We will illuminate the chain with a plane wave traveling in z-direction. To calculate
the field, we define again different areas. By using the lattice sums for arbitrary
points in the unit cell, it is possible to calculate the all positions outside of the
spheres. However, this is comparably slow in comparison to the calculation using the
cylindrical wave expansion. This expansion is only valid outside of the circumscribing
cylinder with infinite length in z-direction.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">pw</span> <span class="o">=</span> <span class="n">treams</span><span class="o">.</span><span class="n">plane_wave</span><span class="p">(</span><span class="n">k0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">grid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mgrid</span><span class="p">[</span><span class="o">-</span><span class="mi">150</span><span class="p">:</span><span class="mi">150</span><span class="p">:</span><span class="mi">51</span><span class="n">j</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">150</span><span class="p">:</span><span class="mi">150</span><span class="p">:</span><span class="mi">51</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span><span class="o">.</span><span class="n">transpose</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
<span class="n">field</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">grid</span><span class="p">,</span> <span class="nb">complex</span><span class="p">)</span>
</pre></div>
</div>
<p>Having the definition of the different areas out of the way, one can do the calculation
now for the different points. First, we have to define the expansion modes around the
point, where we probe the field at.</p>
</section>
</section>
<section id="q-matrix-examples">
<h2><a class="toc-backref" href="#id8" role="doc-backlink">Q-matrix examples</a><a class="headerlink" href="#q-matrix-examples" title="Permalink to this heading">¶</a></h2>
<section id="interfaces-and-homogeneous-media">
<h3><a class="toc-backref" href="#id9" role="doc-backlink">Interfaces and homogeneous media</a><a class="headerlink" href="#interfaces-and-homogeneous-media" title="Permalink to this heading">¶</a></h3>
</section>
<section id="metasurfaces">
<h3><a class="toc-backref" href="#id10" role="doc-backlink">Metasurfaces</a><a class="headerlink" href="#metasurfaces" title="Permalink to this heading">¶</a></h3>
</section>
<section id="gratings">
<h3><a class="toc-backref" href="#id11" role="doc-backlink">Gratings</a><a class="headerlink" href="#gratings" title="Permalink to this heading">¶</a></h3>
</section>
<section id="band-structure">
<h3><a class="toc-backref" href="#id12" role="doc-backlink">Band structure</a><a class="headerlink" href="#band-structure" title="Permalink to this heading">¶</a></h3>
</section>
</section>
<section id="loading-and-storing">
<h2><a class="toc-backref" href="#id13" role="doc-backlink">Loading and storing</a><a class="headerlink" href="#loading-and-storing" title="Permalink to this heading">¶</a></h2>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h3><a href="index.html">Table of Contents</a></h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="gettingstarted.html">Getting started</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="theory.html">Theory</a></li>
<li class="toctree-l1"><a class="reference internal" href="dev.html">Development and contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="about.html">About</a></li>
</ul>

  <div>
    <h4>Previous topic</h4>
    <p class="topless"><a href="gettingstarted.html"
                          title="previous chapter">Getting started</a></p>
  </div>
  <div>
    <h4>Next topic</h4>
    <p class="topless"><a href="theory.html"
                          title="next chapter">Theory</a></p>
  </div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/examples.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="theory.html" title="Theory"
             >next</a> |</li>
        <li class="right" >
          <a href="gettingstarted.html" title="Getting started"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">treams 0.2.2.dev94+gf11285d documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Examples</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2023, Dominik Beutel.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 6.1.3.
    </div>
  </body>
</html>